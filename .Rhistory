#add gleason to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45+gleason,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
print("Residual Standard Error = "+residual)
#create vectors for Residual Standard Error and R-squared
residual <- c(summary(lmod_p)$sigma)
r_squared <- c(summary(lmod_p)$r.squared)
#add lweight to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add svi to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lbph to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add age to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lcp to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add pgg45 to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add gleason to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45+gleason,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
print("Residual Standard Error = ")
print(residual)
print("R-squared = ",r_squared)
#create vectors for Residual Standard Error and R-squared
residual <- c(summary(lmod_p)$sigma)
r_squared <- c(summary(lmod_p)$r.squared)
#add lweight to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add svi to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lbph to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add age to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lcp to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add pgg45 to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add gleason to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45+gleason,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
print("Residual Standard Error = ")
print(residual)
print("R-squared = ")
print(r_squared)
#create vectors for Residual Standard Error and R-squared
residual <- c(summary(lmod_p)$sigma)
r_squared <- c(summary(lmod_p)$r.squared)
#add lweight to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add svi to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lbph to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add age to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lcp to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add pgg45 to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add gleason to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45+gleason,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
print("Residual Standard Error:")
print(residual)
print("R-squared:")
print(r_squared)
#create vectors for Residual Standard Error and R-squared
residual <- c(summary(lmod_p)$sigma)
r_squared <- c(summary(lmod_p)$r.squared)
#add lweight to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add svi to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lbph to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add age to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lcp to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add pgg45 to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add gleason to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45+gleason,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
print("Residual Standard Error:")
print(residual)
print("R-squared:")
print(r_squared)
ggplot(data=residual)+geom_line()+geom_point()
#create vectors for Residual Standard Error and R-squared
residual <- c(summary(lmod_p)$sigma)
r_squared <- c(summary(lmod_p)$r.squared)
#add lweight to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add svi to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lbph to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add age to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lcp to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add pgg45 to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add gleason to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45+gleason,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
print("Residual Standard Error:")
print(residual)
print("R-squared:")
print(r_squared)
ggplot(residual)+geom_line()+geom_point()
#create vectors for Residual Standard Error and R-squared
residual <- c(summary(lmod_p)$sigma)
r_squared <- c(summary(lmod_p)$r.squared)
#add lweight to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add svi to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lbph to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add age to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lcp to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add pgg45 to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add gleason to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45+gleason,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
print("Residual Standard Error:")
print(residual)
print("R-squared:")
print(r_squared)
ggplot(aes(y=residual))+geom_line()+geom_point()
#create vectors for Residual Standard Error and R-squared
residual <- c(summary(lmod_p)$sigma)
r_squared <- c(summary(lmod_p)$r.squared)
#add lweight to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add svi to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lbph to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add age to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lcp to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add pgg45 to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add gleason to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45+gleason,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
print("Residual Standard Error:")
print(residual)
print("R-squared:")
print(r_squared)
plot(residual,type='b')
#create vectors for Residual Standard Error and R-squared
residual <- c(summary(lmod_p)$sigma)
r_squared <- c(summary(lmod_p)$r.squared)
#add lweight to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add svi to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lbph to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add age to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lcp to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add pgg45 to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add gleason to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45+gleason,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
print("Residual Standard Error:")
print(residual)
print("R-squared:")
print(r_squared)
#Plot Residual Standard Error
plot(residual,type='b',ylab='Residual Standard Error')
#Plot R-squared
plot(r_squared,type='b',ylab='R-squared')
knitr::opts_chunk$set(echo = TRUE,fig.height = 5, fig.width = 9)
library(ggplot2)
library(faraway) # include libraries
data(teengamb)    # load the dataset into R workspace
?teengamb         # info of the data
dim(teengamb)     # data frame dimension
head(teengamb)    # head of the data
summary(teengamb) # descriptive
lmod<-lm(gamble~sex+status+income+verbal,teengamb) #linear regression model
summary(lmod)
lmod$residuals #residuals for each observation
max(lmod$residuals) #the max residual
mean(lmod$residuals) # mean of residuals
median(lmod$residuals) #median of residuals
fitted_value<-teengamb$gamble-lmod$residuals
# residual is the difference between true value and fitted values
cor(lmod$residuals,fitted_value)
#find the correlation
cor(lmod$residuals,teengamb$income) #compute the correlation
lmod$coefficients[2]
data(prostate)    # load the dataset into R workspace
?prostate         # info of the data
dim(prostate)     # data frame dimension
head(prostate)    # head of the data
summary(prostate) # descriptive
lmod_p <- lm(lpsa~lcavol,prostate) # create the linear model
summary(lmod_p)
plot1<-ggplot(prostate, aes(x=lcavol,y=lpsa)) + geom_point() + labs(title='Cancer Volume in log vs. prostate specific antigen in log',x='Volume',y='lpsa')
plot1+geom_abline(intercept = lmod_p$coefficients[1], slope = lmod_p$coefficients[2])
# plot the regression line
summary(lmod_p)$sigma
summary(lmod_p)$r.squared
#create vectors for Residual Standard Error and R-squared
residual <- c(summary(lmod_p)$sigma)
r_squared <- c(summary(lmod_p)$r.squared)
#add lweight to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add svi to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lbph to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add age to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add lcp to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add pgg45 to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
#add gleason to the model and store the Residual Standard Error and R-squared
lmod_p <- lm(lpsa~lcavol+lweight+svi+lbph+age+lcp+pgg45+gleason,prostate)
residual <- c(residual,summary(lmod_p)$sigma)
r_squared <- c(r_squared,summary(lmod_p)$r.squared)
print("Residual Standard Error:")
print(residual)
print("R-squared:")
print(r_squared)
#Plot Residual Standard Error
plot(residual,type='b',ylab='Residual Standard Error')
#Plot R-squared
plot(r_squared,type='b',ylab='R-squared')
knitr::opts_chunk$set(echo = TRUE,fig.height = 5, fig.width = 9)
library(ggplot2)
library(faraway) # include libraries
data(teengamb)    # load the dataset into R workspace
?teengamb         # info of the data
dim(teengamb)     # data frame dimension
head(teengamb)    # head of the data
summary(teengamb) # descriptive
lmod<-lm(gamble~sex+status+income+verbal,teengamb) #linear regression model
summary(lmod)
confint(lmod)
confint(lmod, level=0.95)
confint(lmod, level=0.95)
confint(lmod, level=0.95)
confint(lmod, level=0.95)
confint(lmod, level=0.95)
confint(lmod)
confint(lmod)
confint(lmod, level=0.95)
<br>
<br>
# Problem 4
```{r}
data(teengamb)    # load the dataset into R workspace
?teengamb         # info of the data
dim(teengamb)     # data frame dimension
head(teengamb)    # head of the data
summary(teengamb) # descriptive
```
```{r}
lmod<-lm(gamble~sex+status+income+verbal,teengamb) #linear regression model
summary(lmod)
```
```{r}
confint(lmod, level=0.95)
```
confint(lmod, level=0.9)
confint(lmod, level=0.95)
knitr::opts_chunk$set(echo = TRUE,fig.height = 5, fig.width = 9)
lmod_1<-lm(gamble~income,teengamb)
summary(lmod_1)
anova(lmod_1,lmod)
setwd("~/GitHub/Churn-Rate")
library(tidyverse)
install.packages("tidyverse")
install.packages("tidyverse")
library(lubridate)
library(lubridate)
library(imputeTS)
install.packages("imputeTS")
library(imputeTS)
setwd("~/")
library(tidyverse)
library(lubridate)
library(imputeTS)
library(here)
library(tidyverse)
library(lubridate)
library(imputeTS)
library(here)
library(caret)
library(dplyr)
# for parallel computing
library(parallel)
library(doParallel)
setwd("D:/GitHub/Churn-Rate")
df = read.csv("telecom_users.csv")
str(df)
summary(df)
#All entries are unique customer's data
df$Duplicated = duplicated(df$customerID)
df$Duplicated = as.factor(df$Duplicated)
levels(df$Duplicated)
#Handle NA value
colSums(is.na(df))
df_na = df %>%
filter(is.na(df$TotalCharges))
#For all obs with NA in TotalCharges, tenure is 0. As a result, those seems to
#new customer and TotalCharges will be manually populated as the MonthlyCharges
df_na$tenure
df$TotalCharges[is.na(df$TotalCharges)] = df$MonthlyCharges[is.na(df$TotalCharges)]
colSums(is.na(df))
#Get rid of the first two columns: X, customer id, Duplicated
df = df[-c(1,2,23)]
#Classify No phone service, No internet service into No
df$MultipleLines[df$MultipleLines == "No phone service"] = "No"
df$OnlineSecurity[df$OnlineSecurity == "No internet service"] = "No"
df$OnlineBackup[df$OnlineBackup == "No internet service"] = "No"
df$DeviceProtection[df$DeviceProtection == "No internet service"] = "No"
df$TechSupport[df$TechSupport == "No internet service"] = "No"
df$StreamingTV[df$StreamingTV == "No internet service"] = "No"
df$StreamingMovies[df$StreamingMovies == "No internet service"] = "No"
#Change categorical variables to correct data types
df[sapply(df, is.character)] = lapply(df[sapply(df, is.character)], as.factor)
df$SeniorCitizen = as.factor(plyr::mapvalues(df$SeniorCitizen, from=c("0","1"), to=c("No", "Yes")))
#Multicollinearity
source("http://www.sthda.com/upload/rquery_cormat.r")
mydata <- df[, c(5,18,19)]
require("corrplot")
rquery.cormat(mydata)
#Drop TotalCharge, which is MonthlyCharge*tenure
df = df[,-19]
#Scale numeric variables
df$tenure = as.numeric(df$tenure)
ind_numeric = sapply(df, is.numeric)
df[ind_numeric] = lapply(df[ind_numeric], scale)
head(df)
str(df)
set.seed(123)
split = createDataPartition(df$Churn,p = 0.7,list = FALSE)
train = df[split,]
#test set, which is considered as unseen data,
#is saved for the best model after models' performance comparison
test =  df[-split,]
ggplot(train, aes(Churn, fill = Churn))+geom_bar()
library(unbalanced)
levels(train$Churn) <- c(0,1)
levels(test$Churn) <- c(0,1)
input <- train[,1:18]
response <- train$Churn
balance <- ubOver(X=input, Y=response)
new_train <- cbind(balance$X, balance$Y)
colnames(new_train)[19] <- "Churn"
ggplot(new_train, aes(Churn, fill = Churn))+geom_bar()
#----------------------Modeling (Random Forest)---------------------------------
set.seed(123)
cluster <- makeCluster(detectCores() - 2)
registerDoParallel(cluster)
model_rf <- caret::train(Churn ~ .,data = train, method = "rf",
trControl=train_control_parallel,
tuneGrid = expand.grid(.mtry = c(1:18)),
metric="Kappa",
verbose = TRUE)
stopCluster(cluster)
cluster <- makeCluster(detectCores() - 2)
registerDoParallel(cluster)
train_control_parallel <- trainControl(method = "cv", number = 10, allowParallel = TRUE)
model_rf <- caret::train(Churn ~ .,data = train, method = "rf",
trControl=train_control_parallel,
tuneGrid = expand.grid(.mtry = c(1:18)),
metric="Kappa",
verbose = TRUE)
stopCluster(cluster)
model_rf
predict_rf <- predict(model_rf, newdata = test)
result_rf <- confusionMatrix(data = predict_rf, reference = test$Churn, mode = "prec_recall")
F1_rf <- result_rf$byClass[7]
result_rf
F1_rf
